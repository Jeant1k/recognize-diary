#!/bin/bash

# Проверяем, что передано два аргумента: директория и подстрока
if [ "$#" -ne 2 ]; then
    echo "Использование: $0 <директория> <подстрока_в_имени>"
    exit 1
fi

# Присваиваем аргументы переменным для читаемости
SEARCH_DIR="$1"
SUBSTRING="$2"
START_PHRASE="\--- ОБРАБОТАННЫЙ ТЕКСТ LLM ---"

# Проверяем, существует ли указанная директория
if [ ! -d "$SEARCH_DIR" ]; then
    echo "Ошибка: Директория '$SEARCH_DIR' не найдена."
    exit 1
fi

# Инициализируем счетчик результатов
counter=1

# Ищем файлы и обрабатываем их в цикле
# Использование find ... -print0 | while ... — это надежный способ
# для обработки любых имен файлов, включая те, что с пробелами.
find "$SEARCH_DIR" -maxdepth 1 -type f -name "*$SUBSTRING*" -print0 | while IFS= read -r -d '' file; do
    
    # Проверяем, содержит ли файл нужную фразу, чтобы не выводить пустой результат
    if grep -q "$START_PHRASE" "$file"; then
        echo "--- Результат №$counter ---"
        
        # Используем sed для вывода содержимого с нужной строки и до конца файла
        sed -n "/$START_PHRASE/,\$p" "$file"
        
        echo "" # Добавляем пустую строку для лучшего разделения результатов
        ((counter++))
    fi
done

# Если счетчик не изменился, значит ничего не было найдено
if [ "$counter" -eq 1 ]; then
    echo "Файлы, соответствующие критериям, не найдены."
fi
